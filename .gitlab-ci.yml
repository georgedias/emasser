---
stages:
  - build
  - test

build_client_library:
  tags:
    - docker
  stage: build
  image: openjdk:8-jdk
  before_script:
    - curl https://repo1.maven.org/maven2/io/swagger/codegen/v3/swagger-codegen-cli/3.0.26/swagger-codegen-cli-3.0.26.jar -o swagger-codegen-cli
  script:
    # Generate without spec folder because they are not overwritten and the "Generated by swagger-codegen"
    - java -Dmodels -DsupportingFiles -Dapis -Ddocs -DapiTests=false -DmodelTests=false -jar swagger-codegen-cli generate -i ./emass_client/eMASSRestOpenApi.yaml -l ruby -t emass_client/swagger-codegen/ruby_template -o new_ruby_client
    - rm -rf new_ruby_client/spec
    - diff -r emass_client/ruby_client new_ruby_client

testing:
  tags:
    - docker
  stage: test
  image: ruby:2.5
  before_script:
    - gem install bundle
    - bundle install
  script:
    - bundle exec rake test
bundler-audit:
  stage: test
  tags:
    - docker
  image: ruby:2.5
  before_script:
    - gem install bundle
    - bundle install
  script:
    - bundle-audit check --update
lint:
  tags:
    - docker
  stage: test
  image: ruby:2.5
  before_script:
    - gem install bundle
    - bundle install
  script:
    - bundle exec rake rubocop
